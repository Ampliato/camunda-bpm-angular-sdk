"use strict";angular.module("camBpmSdk",[]).value("HttpClient",CamSDK.Client).value("CamForm",CamSDK.Form).value("MockHttpClient",CamSDKMocks).factory("camApiHttpClient",["MockHttpClient","$rootScope",function(e,r){function a(r){var a=r.mock===!0?e:CamSDK.Client.HttpClient;this._wrapped=new a(r)}return angular.forEach(["post","get","load","put","del"],function(e){a.prototype[e]=function(a,t){if(t.done){var o=t.done;t.done=function(e,a){r.$apply(function(){o(e,a)})},this._wrapped[e](a,t)}}}),angular.forEach(["on","once","off","trigger"],function(e){a.prototype[e]=function(){this._wrapped[e].apply(this,arguments)}}),a}]).provider("camApi",function(){var e={apiUri:"engine-rest/engine"};this.setApiConfiguration=function(r){e=r},this.$get=["camApiHttpClient",function(r){var a=angular.copy(e);return a.HttpClient=r,new CamSDK.Client(a)}]}),angular.module("camForm",["camBpmSdk"]).directive("camForm",function(){return{restrict:"EA",scope:{processDefinition:"=",task:"="},controller:["$scope","$element","$compile","camApi",function(e,r,a,t){function o(){e.formScope=e.$new();var r,a=(e.formKey||"").split("embedded:"),t=e.formContextPath||"";a.length>1?(r=a.pop(),t+="/"!==t.slice(-1)?"/":"",r=r.replace(/app:(\/?)/,t)):r=e.formKey,i(),e.formScope.genericVariables=[];var o="<cam-generic-form></cam-generic-form>";n(o)}function i(){e.formScope.variables={},t.http.get(e.resource+"/"+e.resourceId+"/form-variables",{done:function(r,a){if(r)throw r;e.formScope.formVariables=a;for(var t in a){var o=a[t];e.formScope.variables[o.name]=o.value}}})}function n(r){c.html("<div>"+r+"</div>"),a(angular.element(c.children()[0]).contents())(e.formScope)}var c=angular.element(r.children()[0]);e.formVariables={},e.submitForm=function(r){var a={id:e.resourceId};a.variables=e.formVariables,t.resource(e.resource).submitForm(a,function(e,a){if(e){if(!r)throw e;r(e,a)}r&&r(e,a)})},e.$watch("processDefinition",function(){e.processDefinition&&(e.resource="process-definition",e.resourceId=e.processDefinition.id,t.resource(e.resource).startForm({id:e.processDefinition.id},function(r,a){if(r)throw r;a.key&&(e.formKey=a.key,e.formContextPath=a.contextPath,o())}))}),e.$watch("task",function(){e.task&&(e.resource="task",e.resourceId=e.task.id,e.formKey=e.task.formKey,t.http.get("task/"+e.task.id+"/form",{done:function(r,a){if(r)throw r;e.task._embedded||(e.task._embedded={}),e.task._embedded.form=a,e.formContextPath=a.contextPath,o()}}))})}],link:function(){},templateUrl:"directives/camForm/camForm.html"}}).directive("camVariableName",function(){return{restrict:"A",scope:{variableName:"@camVariableName",variableType:"@camVariableType",model:"=ngModel"},require:["ngModel","^camForm"],controller:function(){},link:function(e,r,a,t){var o=t[0];e.$watch(function(){return o.$modelValue},function(){e.formVariables[e.variableName]?e.formVariables[e.variableName].value=o.$modelValue:e.formVariables[e.variableName]={value:o.$modelValue,type:e.variableType}})}}}).directive("camGenericForm",function(){return{restrict:"AE",scope:!0,require:["^camForm"],link:function(e){e.genericVariables=[],e.$watch("formVariables",function(){e.genericVariables=[];for(var r in e.formVariables){var a=e.formVariables[r];e.genericVariables.push({name:r,value:a.value,type:a.type})}}),e.submitGenericForm=function(){for(var r in e.genericVariables){var a=e.genericVariables[r];e.formVariables[a.name]?(e.formVariables[a.name].value=a.value,e.formVariables[a.name].type=a.type):e.formVariables[a.name]=a}e.submitForm()}},templateUrl:"directives/camForm/camGenericForm.html"}}),angular.module("camBpmSdk").run(["$templateCache",function(e){e.put("directives/camForm/camForm.html",'<div ng-form="variablesForm" class="cam-form-container"></div>\n'),e.put("directives/camForm/camGenericForm.html",'<h3>Variables</h3>\n<div ng-repeat="variable in genericVariables" class="row form-group">\n	<div class="col-md-6">\n		<input type="text" ng-model="variable.name" class="form-control" placeholder="name">\n	</div>\n	<div class="col-md-6">\n		<input type="text" ng-model="variable.value" class="form-control" placeholder="value">\n	</div>\n</div>\n<button type="button" class="btn btn-default" ng-click="submitGenericForm()">Submit Form</button>\n')}]);