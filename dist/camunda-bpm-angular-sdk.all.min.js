"use strict";angular.module("camBpmSdk",[]).value("HttpClient",CamSDK.Client).value("CamForm",CamSDK.Form).value("MockHttpClient",CamSDKMocks).factory("camApiHttpClient",["MockHttpClient","$rootScope",function(e,r){function t(r){var t=r.mock===!0?e:CamSDK.Client.HttpClient;this._wrapped=new t(r)}return angular.forEach(["post","get","load","put","del"],function(e){t.prototype[e]=function(t,o){if(o.done){var i=o.done;o.done=function(e,t){r.$apply(function(){i(e,t)})},this._wrapped[e](t,o)}}}),angular.forEach(["on","once","off","trigger"],function(e){t.prototype[e]=function(){this._wrapped[e].apply(this,arguments)}}),t}]).provider("camApi",function(){var e={apiUri:"engine-rest/engine"};this.setApiConfiguration=function(r){e=r},this.$get=["camApiHttpClient",function(r){var t=angular.copy(e);return t.HttpClient=r,new CamSDK.Client(t)}]}),angular.module("camForm",["camBpmSdk"]).directive("camForm",function(){return{restrict:"EA",scope:{processDefinition:"=",task:"="},controller:["$scope","$element","$compile","camApi",function(e,r,t,o){function i(){e.formScope=e.$new();var r,t=(e.formKey||"").split("embedded:"),i=e.formContextPath||"";if(t.length>1?(r=t.pop(),i+="/"!==i.slice(-1)?"/":"",r=r.replace(/app:(\/?)/,i)):r=e.formKey,n(),!r)throw"ErRor";o.http.load(r,{done:function(e,r){if(e)throw e;a(r)}})}function n(){e.formScope.variables={},o.resource(e.resource).formVariables({id:e.resourceId},function(r,t){if(r)throw r;for(var o in t){var i=t[o];e.formScope.variables[i.id]=i.value}})}function a(r){l.html("<div>"+r+"</div>"),t(angular.element(l.children()[0]).contents())(e.formScope)}function c(){e.resource="task",e.resourceId=e.task.id}function m(){e.resource="process-definition",e.resourceId=e.processDefinition.id,o.resource(e.resource).startForm({id:e.processDefinition.id},function(r,t){if(r)throw r;t.key&&(e.formKey=t.key,e.formContextPath=t.contextPath,i())})}var l=angular.element(r.children()[0]);e.formVariables={},this.setFormVariable=function(r,t,o){e.formVariables[r]={value:t,type:o}},this.getFormVariable=function(r){return e.formVariables[r]},e.submitForm=function(r){var t={id:e.resourceId};t.variables=e.formVariables,o.resource(e.resource).submitForm(t,function(e,t){if(e){if(!r)throw e;r(e,t)}r&&r(e,t)})},e.$watch("processDefinition",function(){e.processDefinition&&m()}),e.$watch("task",function(){e.taskId&&c()})}],link:function(){},templateUrl:"directives/camForm/camForm.html"}}).directive("camVariableName",function(){return{restrict:"A",scope:{variableName:"@camVariableName",variableType:"@camVariableType",model:"=ngModel"},require:["ngModel","^camForm"],controller:function(){},link:function(e,r,t,o){var i=o[0],n=o[1];e.$watch(function(){return i.$modelValue},function(){n.setFormVariable(e.variableName,i.$modelValue,e.variableType)})}}}),angular.module("camBpmSdk").run(["$templateCache",function(e){e.put("directives/camForm/camForm.html",'<div ng-form="variablesForm" class="cam-form-container"></div>\n')}]);